<!--# include file="head.html" -->

<h2>handout</h2>

<p>DB stuff:</p>

<pre>
    <b>create sequence</b> employer_id;

    <b>create table</b> employer(
        id         <span style="color: #DD0000">bigint</span> default nextval(<span style="color: #DD0000">'employer_id'</span>) <b>primary key</b>,
        name       <span style="color: #DD0000">varchar</span>(<span style="color: #0000DD">255</span>) <b>not null</b>,
        birth_date <span style="color: #DD0000">timestamp</span> <b>not null</b>,
        created    <span style="color: #DD0000">timestamp</span> <b>not null default</b>(now()),
        modified   <span style="color: #DD0000">timestamp</span> <b>not null default</b>(now())
    );
</pre>

<p>business class:</p>

<pre>
    </span><span style="color: #007700">final class </span><span style="color: #0000BB">Employer </span><span style="color: #007700">extends </span><span style="color: #0000BB">NamedObject
    </span><span style="color: #007700">{
        private </span><span style="color: #0000BB">$birthDate   </span><span style="color: #007700">= </span><span style="color: #0000BB">null</span><span style="color: #007700">;

        private </span><span style="color: #0000BB">$created     </span><span style="color: #007700">= </span><span style="color: #0000BB">null</span><span style="color: #007700">;
        private </span><span style="color: #0000BB">$modified    </span><span style="color: #007700">= </span><span style="color: #0000BB">null</span><span style="color: #007700">;

        public function </span><span style="color: #0000BB">getBirthDate</span><span style="color: #007700">()
        {
            return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">birthDate</span><span style="color: #007700">;
        }

        public function </span><span style="color: #0000BB">setBirthDate</span><span style="color: #007700">(</span><span style="color: #0000BB"><a href="http://svn.shadanakar.org/filedetails.php?repname=onPHP&path=%2Ftrunk%2Fcore%2FBase%2FTimestamp.class.php&rev=0&sc=0">Timestamp</a> $birth</span><span style="color: #007700">)
        {
            </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">birth </span><span style="color: #007700">= </span><span style="color: #0000BB">$birth</span><span style="color: #007700">;

            return </span><span style="color: #0000BB">$this</span><span style="color: #007700">;
        }

        <span style="color: #DD0000">... and so on ...</span>
    }</span>
</pre>

<hr>


<h2>main/<a href="http://svn.shadanakar.org/listing.php?repname=onPHP&path=%2Ftrunk%2Fmain%2FDAOs%2F&rev=0&sc=0">DAOs</a></h2>

<p><a href="http://svn.shadanakar.org/filedetails.php?repname=onPHP&path=%2Ftrunk%2Fmain%2FDAOs%2FSmartDAO.class.php&rev=0&sc=0">SmartDAO</a>'s child:</p>

<pre>
    <span style="color: #007700">final class </span><span style="color: #0000BB">EmployerDAO </span><span style="color: #007700">extends </span><span style="color: #0000BB"><a href="http://svn.shadanakar.org/filedetails.php?repname=onPHP&path=%2Ftrunk%2Fmain%2FDAOs%2FMappedStorableDAO.class.php&rev=0&sc=0">MappedStorableDAO</a>
    </span><span style="color: #007700">{</span>

    ...
</pre>

<p><a href="http://svn.shadanakar.org/filedetails.php?repname=onPHP&path=%2Ftrunk%2Fmain%2FDAOs%2FCommonDAO.class.php&rev=0&sc=0">CommonDAO</a>'s child:</p>

<pre>
    <span style="color: #007700">final class </span><span style="color: #0000BB">EmployerDAO </span><span style="color: #007700">extends </span><span style="color: #0000BB"><a href="http://svn.shadanakar.org/filedetails.php?repname=onPHP&path=%2Ftrunk%2Fmain%2FDAOs%2FCommonDAO.class.php&rev=0&sc=0">CommonDAO</a> <span style="color: #007700">implements </span><span style="color: #0000BB"><a href="http://svn.shadanakar.org/filedetails.php?repname=onPHP&path=%2Ftrunk%2Fmain%2FDAOs%2FMappedDAO.class.php&rev=0&sc=0">MappedDAO</a></span>
    </span><span style="color: #007700">{</span>
        <span style="color: #007700">protected </span><span style="color: #0000BB">$fields </span><span style="color: #007700">= array(
            </span><span style="color: #DD0000">'id'</span><span style="color: #007700">, </span><span style="color: #DD0000">'name'</span><span style="color: #007700">, </span><span style="color: #DD0000">'birthDate'</span><span style="color: #007700">, </span><span style="color: #DD0000">'modified'
        </span><span style="color: #007700">);</span>

        <span style="color: #007700">public function </span><span style="color: #0000BB">getMapping</span><span style="color: #007700">()
        {
            return </span><span style="color: #0000BB">$this</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">mapping</span><span style="color: #007700">;
        }</span>

    ...
</pre>

<p>Parent-independed part:</p>

<pre>
    ...

        <span style="color: #007700">protected </span><span style="color: #0000BB">$mapping </span><span style="color: #007700">= array(
            </span><span style="color: #DD0000">'id'          </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">null</span><span style="color: #007700">,
            </span><span style="color: #DD0000">'name'        </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">null</span><span style="color: #007700">,
            </span><span style="color: #DD0000">'birthDate'   </span><span style="color: #007700">=&gt; </span><span style="color: #DD0000">'birth_date'</span><span style="color: #007700">,
            </span><span style="color: #DD0000">'modified'    </span><span style="color: #007700">=&gt; </span><span style="color: #0000BB">null
        </span><span style="color: #007700">);</span>

        <span style="color: #007700">public </span><span style="color: #0000BB">function getTable</span><span style="color: #007700">()
        {
            return </span><span style="color: #DD0000">'employer'</span><span style="color: #007700">;
        }

        public function </span><span style="color: #0000BB">getObjectName</span><span style="color: #007700">()
        {
            return </span><span style="color: #DD0000">'Employer'</span><span style="color: #007700">;
        }

        public function </span><span style="color: #0000BB">makeObject</span><span style="color: #007700">(&amp;</span><span style="color: #0000BB">$array</span><span style="color: #007700">, </span><span style="color: #0000BB">$prefix </span><span style="color: #007700">= </span><span style="color: #0000BB">null</span><span style="color: #007700">)
        {
            </span><span style="color: #0000BB">$employer </span><span style="color: #007700">= new </span><span style="color: #0000BB">Employer</span><span style="color: #007700">();
            
            return
                </span><span style="color: #0000BB">$employer</span><span style="color: #007700">-&gt;
                    </span><span style="color: #0000BB">setId</span><span style="color: #007700">(</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #0000BB">$prefix</span><span style="color: #007700">.</span><span style="color: #DD0000">'id'</span><span style="color: #007700">])-&gt;
                    </span><span style="color: #0000BB">setName</span><span style="color: #007700">(</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #0000BB">$prefix</span><span style="color: #007700">.</span><span style="color: #DD0000">'name'</span><span style="color: #007700">])-&gt;
                    </span><span style="color: #0000BB">setBirthDate</span><span style="color: #007700">(new </span><span style="color: #0000BB"><a href="http://svn.shadanakar.org/filedetails.php?repname=onPHP&path=%2Ftrunk%2Fcore%2FBase%2FTimestamp.class.php&rev=0&sc=0">Timestamp</a></span><span style="color: #007700">(</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #0000BB">$prefix</span><span style="color: #007700">.</span><span style="color: #DD0000">'birth_date'</span><span style="color: #007700">]))-&gt;
                    </span><span style="color: #0000BB">setModified</span><span style="color: #007700">(new </span><span style="color: #0000BB"><a href="http://svn.shadanakar.org/filedetails.php?repname=onPHP&path=%2Ftrunk%2Fcore%2FBase%2FTimestamp.class.php&rev=0&sc=0">Timestamp</a></span><span style="color: #007700">(</span><span style="color: #0000BB">$array</span><span style="color: #007700">[</span><span style="color: #0000BB">$prefix</span><span style="color: #007700">.</span><span style="color: #DD0000">'modified'</span><span style="color: #007700">]));
        }
        
        public function </span><span style="color: #0000BB">setQueryFields</span><span style="color: #007700">(
            </span><span style="color: #0000BB"><a href="http://svn.shadanakar.org/filedetails.php?repname=onPHP&path=%2Ftrunk%2Fcore%2FOSQL%2FInsertOrUpdateQuery.class.php&rev=0&sc=0">InsertOrUpdateQuery</a> $query</span><span style="color: #007700">, </span><span style="color: #0000BB">Employer $employer
        </span><span style="color: #007700">)
        {
            if (</span><span style="color: #0000BB">$query </span><span style="color: #007700">instanceof </span><span style="color: #0000BB"><a href="http://svn.shadanakar.org/filedetails.php?repname=onPHP&path=%2Ftrunk%2Fcore%2FOSQL%2FUpdateQuery.class.php&rev=0&sc=0">UpdateQuery</a></span><span style="color: #007700">)
                </span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;
                    </span><span style="color: #0000BB">set</span><span style="color: #007700">(
                        </span><span style="color: #DD0000">'modified'</span><span style="color: #007700">,
                        </span><span style="color: #0000BB">$employer</span><span style="color: #007700">-&gt;
                            </span><span style="color: #0000BB">setModified</span><span style="color: #007700">(new </span><span style="color: #0000BB"><a href="http://svn.shadanakar.org/filedetails.php?repname=onPHP&path=%2Ftrunk%2Fcore%2FBase%2FTimestamp.class.php&rev=0&sc=0">Timestamp</a></span><span style="color: #007700">(</span><span style="color: #0000BB">time</span><span style="color: #007700">()))-&gt;
                            </span><span style="color: #0000BB">getModified</span><span style="color: #007700">()-&gt;
                                </span><span style="color: #0000BB">toString</span><span style="color: #007700">()
                    );
            
            return
                </span><span style="color: #0000BB">$query</span><span style="color: #007700">-&gt;
                    </span><span style="color: #0000BB">set</span><span style="color: #007700">(</span><span style="color: #DD0000">'id'</span><span style="color: #007700">, </span><span style="color: #0000BB">$employer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getId</span><span style="color: #007700">())-&gt;
                    </span><span style="color: #0000BB">set</span><span style="color: #007700">(</span><span style="color: #DD0000">'name'</span><span style="color: #007700">, </span><span style="color: #0000BB">$employer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getName</span><span style="color: #007700">())-&gt;
                    </span><span style="color: #0000BB">set</span><span style="color: #007700">(</span><span style="color: #DD0000">'birth_date'</span><span style="color: #007700">, </span><span style="color: #0000BB">$employer</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">getBirthDate</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">toString</span><span style="color: #007700">());
        }
    }</span>
</pre>

<p>hint:</p>

<pre>
    <span style="color: #007700">final class </span><span style="color: #0000BB">DAO
    </span><span style="color: #007700">{
        public static function </span><span style="color: #0000BB">employer</span><span style="color: #007700">()
        {
            return </span><span style="color: #0000BB"><a href="http://svn.shadanakar.org/filedetails.php?repname=onPHP&path=%2Ftrunk%2Fcore%2FBase%2FSingletone.class.php&rev=0&sc=0">Singletone</a></span><span style="color: #007700">::</span><span style="color: #0000BB">getInstance</span><span style="color: #007700">(</span><span style="color: #DD0000">'EmployerDAO'</span><span style="color: #007700">);
        }
    }</span>
</pre>

<p>usage:</p>

<pre>
    <span style="color: #FF8000">// get youn gemployers list sorted by birth date</span>
    <span style="color: #0000BB">$employer </span><span style="color: #007700">= </span><span style="color: #0000BB">DAO</span><span style="color: #007700">::</span><span style="color: #0000BB">employer</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getById</span><span style="color: #007700">(</span><span style="color: #0000BB">2</span><span style="color: #007700">);

    <span style="color: #FF8000">// get young employers list sorted by birth date</span>
    </span><span style="color: #0000BB">$youngEmployersList </span><span style="color: #007700">=
        </span><span style="color: #0000BB">DAO</span><span style="color: #007700">::</span><span style="color: #0000BB">employer</span><span style="color: #007700">()-&gt;</span><span style="color: #0000BB">getList</span><span style="color: #007700">(
            </span><span style="color: #0000BB"><a href="http://svn.shadanakar.org/filedetails.php?repname=onPHP&path=%2Ftrunk%2Fmain%2FDAOs%2FObjectQuery.class.php&rev=0&sc=0">ObjectQuery</a></span><span style="color: #007700">::</span><span style="color: #0000BB">create</span><span style="color: #007700">()-&gt;
            </span><span style="color: #0000BB">sort</span><span style="color: #007700">(</span><span style="color: #DD0000">'birthDate'</span><span style="color: #007700">)-&gt;</span><span style="color: #0000BB">asc</span><span style="color: #007700">()-&gt;
            </span><span style="color: #0000BB">addLogic</span><span style="color: #007700">(
                </span><span style="color: #0000BB"><a href="http://svn.shadanakar.org/filedetails.php?repname=onPHP&path=%2Ftrunk%2Fcore%2FLogic%2FExpression.class.php&rev=0&sc=0">Expression</a></span><span style="color: #007700">::</span><span style="color: #0000BB">gt</span><span style="color: #007700">(
                    </span><span style="color: #DD0000">'birthDate'</span><span style="color: #007700">,
                    </span><span style="color: #0000BB"><a href="http://svn.shadanakar.org/filedetails.php?repname=onPHP&path=%2Ftrunk%2Fcore%2FOSQL%2FDBValue.class.php&rev=0&sc=0">DBValue</a></span><span style="color: #007700">::</span><span style="color: #0000BB">create</span><span style="color: #007700">(</span><span style="color: #0000BB">1970</span><span style="color: #007700">)
                )
            )
        );</span>
</pre>

<hr>

<!--# include file="../parts/heel.html" -->
